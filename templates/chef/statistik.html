{% load static %}
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistik & Analytics - Chef Dashboard</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- SweetAlert2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="{% static 'css/chef/statistik.css' %}">
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar Chef -->
        {% include 'snippets/chef/sidebar.html' %}

        <!-- Main Content -->
        <main class="main-content">
            <!-- Page Header -->
            <div class="page-header">
                <div class="header-content">
                    <div class="header-title-section">
                        <h1 class="page-title">
                            <i class="fas fa-chart-line"></i>
                            Statistik & Analytics
                        </h1>
                        <p class="page-subtitle">Dashboard lengkap performa dan pertumbuhan kelas Anda</p>
                    </div>
                    <div class="header-actions">
                        <div class="date-range-picker">
                            <select id="date-range" class="form-select">
                                <option value="7">7 Hari Terakhir</option>
                                <option value="30" selected>30 Hari Terakhir</option>
                                <option value="90">90 Hari Terakhir</option>
                                <option value="365">1 Tahun Terakhir</option>
                                <option value="all">Semua Waktu</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="exportReport()">
                            <i class="fas fa-download"></i>
                            Export Report
                        </button>
                    </div>
                </div>
            </div>

            <!-- Quick Stats Overview -->
            <div class="quick-stats-grid">
                <div class="stat-card-large primary">
                    <div class="stat-card-header">
                        <div class="stat-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-trend">
                            <span class="trend-badge up">
                                <i class="fas fa-arrow-up"></i> 23.5%
                            </span>
                        </div>
                    </div>
                    <div class="stat-card-body">
                        <h3 class="stat-label">Total Pendapatan</h3>
                        <div class="stat-value" id="total-revenue">Rp 45.750.000</div>
                        <p class="stat-description">
                            <span class="highlight">+Rp 8.5jt</span> dari bulan lalu
                        </p>
                    </div>
                    <div class="stat-card-footer">
                        <div class="mini-chart">
                            <canvas id="revenue-mini-chart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="stat-card-large success">
                    <div class="stat-card-header">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-trend">
                            <span class="trend-badge up">
                                <i class="fas fa-arrow-up"></i> 18.2%
                            </span>
                        </div>
                    </div>
                    <div class="stat-card-body">
                        <h3 class="stat-label">Total Murid Aktif</h3>
                        <div class="stat-value" id="total-students">156</div>
                        <p class="stat-description">
                            <span class="highlight">+24 murid</span> bulan ini
                        </p>
                    </div>
                    <div class="stat-card-footer">
                        <div class="mini-chart">
                            <canvas id="students-mini-chart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="stat-card-large warning">
                    <div class="stat-card-header">
                        <div class="stat-icon">
                            <i class="fas fa-book-open"></i>
                        </div>
                        <div class="stat-trend">
                            <span class="trend-badge up">
                                <i class="fas fa-arrow-up"></i> 12.5%
                            </span>
                        </div>
                    </div>
                    <div class="stat-card-body">
                        <h3 class="stat-label">Kelas Aktif</h3>
                        <div class="stat-value" id="active-classes">8</div>
                        <p class="stat-description">
                            <span class="highlight">2 kelas baru</span> bulan ini
                        </p>
                    </div>
                    <div class="stat-card-footer">
                        <div class="mini-chart">
                            <canvas id="classes-mini-chart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="stat-card-large info">
                    <div class="stat-card-header">
                        <div class="stat-icon">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div class="stat-trend">
                            <span class="trend-badge up">
                                <i class="fas fa-arrow-up"></i> 8.3%
                            </span>
                        </div>
                    </div>
                    <div class="stat-card-body">
                        <h3 class="stat-label">Tingkat Completion</h3>
                        <div class="stat-value" id="completion-rate">78.5%</div>
                        <p class="stat-description">
                            <span class="highlight">122 murid</span> selesai kelas
                        </p>
                    </div>
                    <div class="stat-card-footer">
                        <div class="mini-chart">
                            <canvas id="completion-mini-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Analytics Grid -->
            <div class="analytics-grid">
                <!-- Revenue Analytics -->
                <div class="analytics-card large">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-chart-area"></i>
                            <h3>Analisis Pendapatan</h3>
                        </div>
                        <div class="card-actions">
                            <div class="chart-type-toggle">
                                <button class="toggle-btn active" data-chart="revenue" data-type="line">
                                    <i class="fas fa-chart-line"></i>
                                </button>
                                <button class="toggle-btn" data-chart="revenue" data-type="bar">
                                    <i class="fas fa-chart-bar"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="revenue-chart"></canvas>
                        </div>
                        <div class="chart-legend">
                            <div class="legend-item">
                                <span class="legend-color primary"></span>
                                <span class="legend-label">Pendapatan Kotor</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color success"></span>
                                <span class="legend-label">Pendapatan Bersih</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Student Growth -->
                <div class="analytics-card medium">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-user-plus"></i>
                            <h3>Pertumbuhan Murid</h3>
                        </div>
                        <div class="card-actions">
                            <button class="btn-icon" onclick="refreshStudentData()">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="student-growth-chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Top Performing Classes -->
                <div class="analytics-card medium">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-trophy"></i>
                            <h3>Kelas Terpopuler</h3>
                        </div>
                        <div class="card-actions">
                            <select class="form-select-sm" id="performance-metric">
                                <option value="students">Jumlah Murid</option>
                                <option value="revenue">Pendapatan</option>
                                <option value="rating">Rating</option>
                                <option value="completion">Completion Rate</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="ranking-list" id="top-classes">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Revenue by Category -->
                <div class="analytics-card medium">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-chart-pie"></i>
                            <h3>Pendapatan per Kategori</h3>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container chart-pie">
                            <canvas id="category-revenue-chart"></canvas>
                        </div>
                        <div class="category-stats" id="category-breakdown">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Student Demographics -->
                <div class="analytics-card medium">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-users-cog"></i>
                            <h3>Demografi Murid</h3>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="demographics-chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Engagement Metrics -->
                <div class="analytics-card medium">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-heart-pulse"></i>
                            <h3>Tingkat Engagement</h3>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="engagement-metrics">
                            <div class="metric-item">
                                <div class="metric-circle">
                                    <svg class="progress-ring" width="120" height="120">
                                        <circle class="progress-ring-circle bg" cx="60" cy="60" r="50"></circle>
                                        <circle class="progress-ring-circle" cx="60" cy="60" r="50" id="active-ring"></circle>
                                    </svg>
                                    <div class="metric-value">
                                        <span class="value" id="active-students">85%</span>
                                        <span class="label">Aktif</span>
                                    </div>
                                </div>
                                <p class="metric-description">Murid Aktif Mingguan</p>
                            </div>
                            
                            <div class="metric-item">
                                <div class="metric-circle">
                                    <svg class="progress-ring" width="120" height="120">
                                        <circle class="progress-ring-circle bg" cx="60" cy="60" r="50"></circle>
                                        <circle class="progress-ring-circle" cx="60" cy="60" r="50" id="completion-ring"></circle>
                                    </svg>
                                    <div class="metric-value">
                                        <span class="value" id="completion-students">78%</span>
                                        <span class="label">Selesai</span>
                                    </div>
                                </div>
                                <p class="metric-description">Completion Rate</p>
                            </div>
                            
                            <div class="metric-item">
                                <div class="metric-circle">
                                    <svg class="progress-ring" width="120" height="120">
                                        <circle class="progress-ring-circle bg" cx="60" cy="60" r="50"></circle>
                                        <circle class="progress-ring-circle" cx="60" cy="60" r="50" id="satisfaction-ring"></circle>
                                    </svg>
                                    <div class="metric-value">
                                        <span class="value" id="satisfaction-rate">92%</span>
                                        <span class="label">Puas</span>
                                    </div>
                                </div>
                                <p class="metric-description">Kepuasan Murid</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Reviews -->
                <div class="analytics-card large">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-star"></i>
                            <h3>Review & Rating Terbaru</h3>
                        </div>
                        <div class="card-actions">
                            <div class="rating-summary">
                                <div class="avg-rating">4.7</div>
                                <div class="stars">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star-half-alt"></i>
                                </div>
                                <div class="total-reviews">dari 248 review</div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="reviews-distribution">
                            <div class="rating-bar">
                                <span class="rating-label">5 <i class="fas fa-star"></i></span>
                                <div class="bar-container">
                                    <div class="bar-fill" style="width: 75%"></div>
                                </div>
                                <span class="rating-count">186</span>
                            </div>
                            <div class="rating-bar">
                                <span class="rating-label">4 <i class="fas fa-star"></i></span>
                                <div class="bar-container">
                                    <div class="bar-fill" style="width: 15%"></div>
                                </div>
                                <span class="rating-count">37</span>
                            </div>
                            <div class="rating-bar">
                                <span class="rating-label">3 <i class="fas fa-star"></i></span>
                                <div class="bar-container">
                                    <div class="bar-fill" style="width: 6%"></div>
                                </div>
                                <span class="rating-count">15</span>
                            </div>
                            <div class="rating-bar">
                                <span class="rating-label">2 <i class="fas fa-star"></i></span>
                                <div class="bar-container">
                                    <div class="bar-fill" style="width: 3%"></div>
                                </div>
                                <span class="rating-count">7</span>
                            </div>
                            <div class="rating-bar">
                                <span class="rating-label">1 <i class="fas fa-star"></i></span>
                                <div class="bar-container">
                                    <div class="bar-fill" style="width: 1%"></div>
                                </div>
                                <span class="rating-count">3</span>
                            </div>
                        </div>
                        
                        <div class="recent-reviews-list" id="recent-reviews">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Performance Metrics Table -->
                <div class="analytics-card full-width">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-table"></i>
                            <h3>Detail Performa Kelas</h3>
                        </div>
                        <div class="card-actions">
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="Cari kelas..." id="class-search">
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="performance-table" id="performance-table">
                                <thead>
                                    <tr>
                                        <th>Kelas</th>
                                        <th>Kategori</th>
                                        <th>Murid</th>
                                        <th>Pendapatan</th>
                                        <th>Rating</th>
                                        <th>Completion</th>
                                        <th>Trend</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="performance-table-body">
                                    <!-- Will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Financial Summary Section -->
            <div class="financial-summary">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-wallet"></i>
                        Ringkasan Keuangan
                    </h2>
                </div>
                
                <div class="financial-grid">
                    <div class="financial-card">
                        <div class="financial-header">
                            <div class="icon-wrapper income">
                                <i class="fas fa-arrow-trend-up"></i>
                            </div>
                            <h4>Pemasukan</h4>
                        </div>
                        <div class="financial-amount income">
                            Rp 45.750.000
                        </div>
                        <div class="financial-details">
                            <div class="detail-item">
                                <span class="detail-label">Kelas Basic:</span>
                                <span class="detail-value">Rp 28.500.000</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Kelas Premium:</span>
                                <span class="detail-value">Rp 17.250.000</span>
                            </div>
                        </div>
                    </div>

                    <div class="financial-card">
                        <div class="financial-header">
                            <div class="icon-wrapper expense">
                                <i class="fas fa-arrow-trend-down"></i>
                            </div>
                            <h4>Biaya Platform</h4>
                        </div>
                        <div class="financial-amount expense">
                            Rp 4.575.000
                        </div>
                        <div class="financial-details">
                            <div class="detail-item">
                                <span class="detail-label">Fee (10%):</span>
                                <span class="detail-value">Rp 4.575.000</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Admin:</span>
                                <span class="detail-value">Rp 0</span>
                            </div>
                        </div>
                    </div>

                    <div class="financial-card highlight">
                        <div class="financial-header">
                            <div class="icon-wrapper net">
                                <i class="fas fa-hand-holding-dollar"></i>
                            </div>
                            <h4>Pendapatan Bersih</h4>
                        </div>
                        <div class="financial-amount net">
                            Rp 41.175.000
                        </div>
                        <div class="financial-progress">
                            <div class="progress-info">
                                <span>Target Bulanan: Rp 40.000.000</span>
                                <span class="progress-percentage">102.9%</span>
                            </div>
                            <div class="progress-bar-financial">
                                <div class="progress-fill-financial" style="width: 102.9%"></div>
                            </div>
                        </div>
                    </div>

                    <div class="financial-card">
                        <div class="financial-header">
                            <div class="icon-wrapper pending">
                                <i class="fas fa-clock"></i>
                            </div>
                            <h4>Pending Payout</h4>
                        </div>
                        <div class="financial-amount pending">
                            Rp 8.250.000
                        </div>
                        <div class="financial-details">
                            <div class="detail-item">
                                <span class="detail-label">Estimasi Payout:</span>
                                <span class="detail-value">10 Feb 2026</span>
                            </div>
                            <button class="btn btn-sm btn-primary" onclick="requestPayout()">
                                <i class="fas fa-paper-plane"></i>
                                Request Payout
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Insights & Recommendations -->
            <div class="insights-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-lightbulb"></i>
                        Insights & Rekomendasi
                    </h2>
                </div>

                <div class="insights-grid" id="insights-container">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </main>
    </div>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Statistics JavaScript -->
    <script src="{% static 'js/chef/statistik.js' %}"></script>
</body>
</html>