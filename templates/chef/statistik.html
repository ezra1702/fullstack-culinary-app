{% load static %}
<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Statistik & Analytics — Chef Dashboard</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<link rel="stylesheet" href="{% static 'css/chef/statistik.css' %}">
</head>
<body>

<!-- =============================================
     SIDEBAR — LIGHT (sesuai referensi)
============================================= -->
{% include "snippets/chef/sidebar.html" %}

<!-- =============================================
     MAIN CONTENT
============================================= -->
<main class="main">

  <!-- Page Header -->
  <div class="page-header">
    <div class="ph-inner">
      <div>
        <div class="ph-title"><i class="fas fa-chart-line"></i> Statistik & Analytics</div>
        <div class="ph-sub">Dashboard lengkap performa dan pertumbuhan kelas Anda</div>
      </div>
      <div class="ph-actions">
        <select class="ph-select" id="date-range">
          <option value="7">7 Hari Terakhir</option>
          <option value="30" selected>30 Hari Terakhir</option>
          <option value="90">90 Hari Terakhir</option>
          <option value="365">1 Tahun Terakhir</option>
        </select>
        <button class="btn-export" onclick="exportReport()"><i class="fas fa-download"></i> Export</button>
      </div>
    </div>
  </div>

  <!-- Hero Stats -->
  <div class="stats-hero">
    <div class="hero-card c1">
      <div class="hc-top">
        <div class="hc-icon"><i class="fas fa-money-bill-wave"></i></div>
        <span class="hc-badge up"><i class="fas fa-arrow-up"></i> 23.5%</span>
      </div>
      <div class="hc-label">Total Pendapatan</div>
      <div class="hc-val">Rp 45.75jt</div>
      <div class="hc-desc"><strong>+Rp 8.5jt</strong> dari bulan lalu</div>
      <div class="hc-chart"><canvas id="mini1"></canvas></div>
    </div>
    <div class="hero-card c2">
      <div class="hc-top">
        <div class="hc-icon"><i class="fas fa-users"></i></div>
        <span class="hc-badge up"><i class="fas fa-arrow-up"></i> 18.2%</span>
      </div>
      <div class="hc-label">Total Murid Aktif</div>
      <div class="hc-val">156</div>
      <div class="hc-desc"><strong>+24 murid</strong> bulan ini</div>
      <div class="hc-chart"><canvas id="mini2"></canvas></div>
    </div>
    <div class="hero-card c3">
      <div class="hc-top">
        <div class="hc-icon"><i class="fas fa-book-open"></i></div>
        <span class="hc-badge up"><i class="fas fa-arrow-up"></i> 12.5%</span>
      </div>
      <div class="hc-label">Kelas Aktif</div>
      <div class="hc-val">8</div>
      <div class="hc-desc"><strong>2 kelas baru</strong> bulan ini</div>
      <div class="hc-chart"><canvas id="mini3"></canvas></div>
    </div>
    <div class="hero-card c4">
      <div class="hc-top">
        <div class="hc-icon"><i class="fas fa-graduation-cap"></i></div>
        <span class="hc-badge up"><i class="fas fa-arrow-up"></i> 8.3%</span>
      </div>
      <div class="hc-label">Tingkat Completion</div>
      <div class="hc-val">78.5%</div>
      <div class="hc-desc"><strong>122 murid</strong> selesai kelas</div>
      <div class="hc-chart"><canvas id="mini4"></canvas></div>
    </div>
  </div>

  <!-- Analytics Grid -->
  <div class="analytics-grid">

    <!-- Revenue Chart -->
    <div class="ag-card span8">
      <div class="ag-header">
        <div class="ag-title"><i class="fas fa-chart-area"></i><h3>Analisis Pendapatan</h3></div>
        <div class="ag-actions">
          <div class="btn-toggle-group">
            <button class="btn-toggle active" onclick="toggleChart(this,'line')"><i class="fas fa-chart-line"></i></button>
            <button class="btn-toggle" onclick="toggleChart(this,'bar')"><i class="fas fa-chart-bar"></i></button>
          </div>
        </div>
      </div>
      <div class="chart-wrap h360"><canvas id="revenueChart"></canvas></div>
    </div>

    <!-- Student Growth -->
    <div class="ag-card span4">
      <div class="ag-header">
        <div class="ag-title"><i class="fas fa-user-plus"></i><h3>Pertumbuhan Murid</h3></div>
        <div class="ag-actions">
          <button class="btn-icon-sm" onclick="refreshSpin(this)"><i class="fas fa-sync-alt"></i></button>
        </div>
      </div>
      <div class="chart-wrap h360"><canvas id="studentChart"></canvas></div>
    </div>

    <!-- Top Classes -->
    <div class="ag-card span6">
      <div class="ag-header">
        <div class="ag-title"><i class="fas fa-trophy"></i><h3>Kelas Terpopuler</h3></div>
        <div class="ag-actions">
          <select class="sel-sm" onchange="updateRanking(this.value)">
            <option value="students">Jumlah Murid</option>
            <option value="revenue">Pendapatan</option>
            <option value="rating">Rating</option>
          </select>
        </div>
      </div>
      <div class="ranking-list" id="ranking-list"></div>
    </div>

    <!-- Revenue by Category -->
    <div class="ag-card span6">
      <div class="ag-header">
        <div class="ag-title"><i class="fas fa-chart-pie"></i><h3>Pendapatan per Kategori</h3></div>
      </div>
      <div class="chart-wrap h220"><canvas id="pieChart"></canvas></div>
      <div class="cat-list" id="cat-list"></div>
    </div>

    <!-- Demographics -->
    <div class="ag-card span6">
      <div class="ag-header">
        <div class="ag-title"><i class="fas fa-users-cog"></i><h3>Demografi Murid</h3></div>
      </div>
      <div class="chart-wrap h300"><canvas id="demoChart"></canvas></div>
    </div>

    <!-- Engagement -->
    <div class="ag-card span6">
      <div class="ag-header">
        <div class="ag-title"><i class="fas fa-heart-pulse"></i><h3>Tingkat Engagement</h3></div>
      </div>
      <div class="engagement-wrap">
        <div class="eng-item">
          <div class="ring-wrap">
            <svg width="110" height="110" viewBox="0 0 110 110">
              <circle class="ring-bg" cx="55" cy="55" r="45"/>
              <circle class="ring-fill" cx="55" cy="55" r="45" stroke="#2e8b57"
                stroke-dasharray="283" stroke-dashoffset="42"/>
            </svg>
            <div class="ring-center"><span class="ring-pct">85%</span><span class="ring-lbl">Aktif</span></div>
          </div>
          <div class="eng-desc">Murid Aktif Mingguan</div>
        </div>
        <div class="eng-item">
          <div class="ring-wrap">
            <svg width="110" height="110" viewBox="0 0 110 110">
              <circle class="ring-bg" cx="55" cy="55" r="45"/>
              <circle class="ring-fill" cx="55" cy="55" r="45" stroke="#059669"
                stroke-dasharray="283" stroke-dashoffset="62"/>
            </svg>
            <div class="ring-center"><span class="ring-pct">78%</span><span class="ring-lbl">Selesai</span></div>
          </div>
          <div class="eng-desc">Completion Rate</div>
        </div>
        <div class="eng-item">
          <div class="ring-wrap">
            <svg width="110" height="110" viewBox="0 0 110 110">
              <circle class="ring-bg" cx="55" cy="55" r="45"/>
              <circle class="ring-fill" cx="55" cy="55" r="45" stroke="#0891b2"
                stroke-dasharray="283" stroke-dashoffset="23"/>
            </svg>
            <div class="ring-center"><span class="ring-pct">92%</span><span class="ring-lbl">Puas</span></div>
          </div>
          <div class="eng-desc">Kepuasan Murid</div>
        </div>
      </div>
    </div>

    <!-- Reviews — FIXED LAYOUT -->
    <div class="ag-card span12">
      <div class="ag-header">
        <div class="ag-title"><i class="fas fa-star"></i><h3>Review & Rating Terbaru</h3></div>
      </div>
      <div class="review-section-body">
        <!-- Kiri: Summary + Bar Chart -->
        <div class="rating-summary-box">
          <div class="rs-hero">
            <div class="rs-big">4.7</div>
            <div class="rs-right">
              <div class="rs-stars">
                <i class="fas fa-star"></i><i class="fas fa-star"></i>
                <i class="fas fa-star"></i><i class="fas fa-star"></i>
                <i class="fas fa-star-half-alt"></i>
              </div>
              <div class="rs-total">dari 248 review</div>
            </div>
          </div>
          <div class="rev-dist">
            <div class="rev-bar">
              <span class="rev-lbl">5 <i class="fas fa-star"></i></span>
              <div class="rev-track"><div class="rev-fill" style="width:75%"></div></div>
              <span class="rev-count">186</span>
            </div>
            <div class="rev-bar">
              <span class="rev-lbl">4 <i class="fas fa-star"></i></span>
              <div class="rev-track"><div class="rev-fill" style="width:15%"></div></div>
              <span class="rev-count">37</span>
            </div>
            <div class="rev-bar">
              <span class="rev-lbl">3 <i class="fas fa-star"></i></span>
              <div class="rev-track"><div class="rev-fill" style="width:6%"></div></div>
              <span class="rev-count">15</span>
            </div>
            <div class="rev-bar">
              <span class="rev-lbl">2 <i class="fas fa-star"></i></span>
              <div class="rev-track"><div class="rev-fill" style="width:3%"></div></div>
              <span class="rev-count">7</span>
            </div>
            <div class="rev-bar">
              <span class="rev-lbl">1 <i class="fas fa-star"></i></span>
              <div class="rev-track"><div class="rev-fill" style="width:1%"></div></div>
              <span class="rev-count">3</span>
            </div>
          </div>
        </div>
        <!-- Kanan: Daftar Review -->
        <div class="reviews-list" id="reviews-list"></div>
      </div>
    </div>

    <!-- Performance Table -->
    <div class="ag-card span12">
      <div class="ag-header">
        <div class="ag-title"><i class="fas fa-table"></i><h3>Detail Performa Kelas</h3></div>
        <div class="search-wrap">
          <i class="fas fa-search"></i>
          <input type="text" placeholder="Cari kelas..." oninput="filterTable(this.value)">
        </div>
      </div>
      <div class="tbl-wrap">
        <table>
          <thead>
            <tr>
              <th>Kelas</th><th>Kategori</th><th>Murid</th><th>Pendapatan</th>
              <th>Rating</th><th>Completion</th><th>Trend</th><th>Aksi</th>
            </tr>
          </thead>
          <tbody id="tbl-body"></tbody>
        </table>
      </div>
    </div>
  </div><!-- end analytics-grid -->

  <!-- Financial -->
  <div class="section-title-bar"><i class="fas fa-wallet"></i><h2>Ringkasan Keuangan</h2></div>
  <div class="fin-grid">
    <div class="fin-card">
      <div class="fin-top"><div class="fin-icon fi-income"><i class="fas fa-arrow-trend-up"></i></div><h4>Pemasukan</h4></div>
      <div class="fin-amount fa-income">Rp 45.750.000</div>
      <div class="fin-detail">
        <div class="fd-row"><span class="fd-label">Kelas Basic:</span><span class="fd-val">Rp 28.500.000</span></div>
        <div class="fd-row"><span class="fd-label">Kelas Premium:</span><span class="fd-val">Rp 17.250.000</span></div>
      </div>
    </div>
    <div class="fin-card">
      <div class="fin-top"><div class="fin-icon fi-expense"><i class="fas fa-arrow-trend-down"></i></div><h4>Biaya Platform</h4></div>
      <div class="fin-amount fa-expense">Rp 4.575.000</div>
      <div class="fin-detail">
        <div class="fd-row"><span class="fd-label">Fee (10%):</span><span class="fd-val">Rp 4.575.000</span></div>
        <div class="fd-row"><span class="fd-label">Admin:</span><span class="fd-val">Rp 0</span></div>
      </div>
    </div>
    <div class="fin-card highlight">
      <div class="fin-top"><div class="fin-icon fi-net"><i class="fas fa-hand-holding-dollar"></i></div><h4>Pendapatan Bersih</h4></div>
      <div class="fin-amount fa-net">Rp 41.175.000</div>
      <div class="prog-label">
        <span style="font-size:.76rem;color:var(--text-muted)">Target: Rp 40jt</span>
        <span class="prog-pct">102.9%</span>
      </div>
      <div class="prog-track"><div class="prog-fill" style="width:100%"></div></div>
    </div>
    <div class="fin-card">
      <div class="fin-top"><div class="fin-icon fi-pend"><i class="fas fa-clock"></i></div><h4>Pending Payout</h4></div>
      <div class="fin-amount fa-pend">Rp 8.250.000</div>
      <div class="fin-detail">
        <div class="fd-row"><span class="fd-label">Est. Payout:</span><span class="fd-val">10 Feb 2026</span></div>
      </div>
      <button class="btn-payout" onclick="requestPayout()"><i class="fas fa-paper-plane"></i> Request Payout</button>
    </div>
  </div>

  <!-- Insights -->
  <div class="section-title-bar"><i class="fas fa-lightbulb"></i><h2>Insights & Rekomendasi</h2></div>
  <div class="insights-grid" id="insights-grid"></div>

</main>

<script src="{% static 'js/chef/statistik.js' %}"></script>
</body>
</html>
